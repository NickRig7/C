<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Swipe News Cards</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&display=swap" rel="stylesheet" />

  <link rel="manifest" href="/static/manifest.json" />
  <meta name="theme-color" content="#00bcd4" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <link rel="apple-touch-icon" href="/static/icons/cso.jpg" />

  <style>
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', sans-serif;
      background: #121212;
      min-height: 100vh;
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      overflow-x: hidden;
    }

    .main-container {
      width: 100%;
      max-width: 430px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .info-box {
      width: 100%;
      background-image: url('/static/xyz.png');
      background-size: cover;
      background-repeat: no-repeat;
      background-position: center;
      background-color: rgba(0, 0, 0, 0.5);
      background-blend-mode: darken;
      color: #ffffff;
      border-radius: 20px 20px 0 0;
      box-shadow: 0 0 20px rgba(175, 189, 189, 0.2);
    }

    .info-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.75rem 1rem 0.5rem;
    }

    .info-logo-inline {
      height: 42px;
      width: auto;
    }

    .info-title {
      font-family: 'Montserrat', sans-serif;
      font-weight: 700;
      font-size: 1.1rem;
      color: #d6c5c5;
    }

    .hamburger-menu {
      font-size: 16px;
      cursor: pointer;
      color: #000;
      padding: 4px 10px;
      background-color: #a38b6c;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(255, 255, 255, 0.1);
      transition: background 0.3s;
    }

    .hamburger-menu:hover {
      background-color: #e0e0e0;
    }

    .category-scroll {
      display: flex;
      overflow-x: auto;
      padding: 0.5rem 1rem 0.8rem;
      gap: 0.5rem;
      scrollbar-width: none;
      -ms-overflow-style: none;
    }

    .category-scroll::-webkit-scrollbar {
      display: none;
    }

    .category-btn {
      flex: 0 0 auto;
      background-color: #1e1e1e;
      border: none;
      padding: 0.4rem 0.9rem;
      color: #ffffff;
      border-radius: 20px;
      font-size: 0.85rem;
      cursor: pointer;
      transition: background 0.3s, box-shadow 0.3s;
      box-shadow: 0 0 10px rgba(175, 189, 189, 0.1);
    }

    .category-btn:hover {
      background-color: #171616;
    }

    .category-btn.active {
      background-color: #00bcd4;
      color: #121212;
      font-weight: bold;
      box-shadow: 0 0 20px rgba(0, 255, 255, 0.4);
    }

    .card-stack {
      position: relative;
      width: 100%;
      max-width: 430px;
      height: 560px;
      border-radius: 0 0 20px 20px;
      box-shadow: 0 0 20px rgba(175, 189, 189, 0.2);
      overflow: hidden;
    }

    .card {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #1e1e1e;
      border-radius: 0 0 20px 20px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      cursor: grab;
      transition: transform 0.3s ease, opacity 0.3s ease, box-shadow 0.3s ease;
    }

    .card:hover {
      transform: scale(1.015);
      box-shadow:
        0 0 25px rgba(0, 255, 255, 0.7),
        0 0 40px rgba(0, 255, 255, 0.4),
        0 0 60px rgba(0, 255, 255, 0.2);
      z-index: 2;
    }

    .card img {
      width: 100%;
      height: 220px;
      object-fit: cover;
    }

    .card-content {
      padding: 1.5rem;
      display: flex;
      flex-direction: column;
      flex-grow: 1;
    }

    .title {
      font-size: 1.2rem;
      font-weight: bold;
      margin-bottom: 0.8rem;
      color: #ffffff;
    }

    .summary {
      font-size: 1.05rem;
      color: #cccccc;
      line-height: 1.4;
      flex-grow: 1;
    }

    .read-more {
      margin-top: 1rem;
      text-align: right;
    }

    .read-more a {
      text-decoration: none;
      color: #00bcd4;
      font-weight: bold;
      font-size: 0.9rem;
      transition: color 0.3s ease;
    }

    .read-more a:hover {
      color: #1de9b6;
      text-decoration: underline;
    }

    .side-menu {
      position: fixed;
      top: 0;
      right: -80%;
      width: 75%;
      max-width: 300px;
      height: 100%;
      background-color: rgba(30, 30, 30, 0.8);
      backdrop-filter: blur(8px);
      z-index: 999;
      box-shadow: -4px 0 20px rgba(0, 0, 0, 0.5);
      transition: right 0.3s ease, opacity 0.3s ease;
      border-radius: 20px 0 0 20px;
      padding: 1rem;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      opacity: 0;
      pointer-events: none;
    }

    /* For desktop/laptop: position side-menu inside main-container */
    @media (min-width: 768px) {
      .main-container {
        position: relative;
      }

      .side-menu {
        position: absolute;
        top: 0;
        right: -100%;
        height: 100%;
      }

      .side-menu.open {
        right: 0;
      }
    }

    .side-menu.open {
      right: 0;
      opacity: 1;
      pointer-events: auto;
    }

    .side-menu-img {
      width: 100%;
      height: 30%;
      object-fit: cover;
      border-radius: 20px 20px 0 0;
      filter: brightness(0.6) saturate(1.5);
      margin-bottom: 1rem;
    }

    .social-links {
      display: flex;
      flex-direction: column;
      align-items: center; /* keeps separators centered */
      gap: 0.6rem;
      width: 100%;
    }

    .social-link {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      font-size: 1rem;
      color: #ffffff;
      padding: 0.3rem 0;
      justify-content: flex-start;
      width: 80%;
      max-width: 250px;
      margin-left: 4rem; /* ✅ shift icon+text to the right only */
    }

    .social-link a {
      color: #ffffff;
      text-decoration: none;
      font-weight: 500;
      transition: color 0.3s ease;
    }

    .social-link a:hover {
      color: #00bcd4;
    }

    .social-icon {
      width: 30px;
      height: 30px;
      object-fit: contain;
      flex-shrink: 0;
    }

    .social-separator {
      border: none;
      height: 1px;
      background-color: rgba(150, 150, 150, 0.25);
      margin: 0.4rem 0;
      width: 55%; /* ✅ keep this centered */
      align-self: center;
    }

    .side-menu-footer {
      margin-top: auto;
      padding-top: 10rem;
      font-size: 0.75rem;
      color: rgba(255, 255, 255, 0.4);
      text-align: center;
    }

    .card.swiping {
      box-shadow:
        0 0 25px rgba(0, 255, 255, 0.7),
        0 0 40px rgba(0, 255, 255, 0.4),
        0 0 60px rgba(0, 255, 255, 0.2);
      z-index: 2;
    }
        
    @media (hover: hover) and (pointer: fine) {
      .card:hover {
        transform: scale(1.015);
        box-shadow:
          0 0 25px rgba(0, 255, 255, 0.7),
          0 0 40px rgba(0, 255, 255, 0.4),
          0 0 60px rgba(0, 255, 255, 0.2);
        z-index: 2;
      }
    }

  </style>
</head>
<!-- HEAD and STYLE remain same from previous step -->

<body>
  <div class="main-container">
    <div class="info-box">
      <div class="info-header">
        <img src="/static/logo.png" alt="Logo" class="info-logo-inline" />
        <span class="info-title">ChainShots</span>
        <div class="hamburger-menu">&#9776;</div>
      </div>
      <div class="category-scroll">
        <button class="category-btn active" data-category="daily-news">Daily News</button>
        <button class="category-btn" data-category="edu">Edu Bites</button>
        <button class="category-btn" data-category="btca">BTC Action</button>
        <button class="category-btn" data-category="for-you">For You</button>
      </div>
    </div>

    <div class="card-stack" id="news-container"></div>

    <div class="side-menu" id="sideMenu">
      <img src="/static/abc.png" alt="Side Menu Banner" class="side-menu-img" />
      <div class="social-links">
      <div class="social-link">
        <img src="/static/twwit.png" alt="Twitter" class="social-icon" />
        <a href="https://twitter.com/yourhandle" target="_blank">Twitter</a>
      </div>
      <hr class="social-separator" />
      <div class="social-link">
        <img src="/static/web.png" alt="Telegram" class="social-icon" />
        <a href="https://t.me/yourhandle" target="_blank">Telegram</a>
      </div>
      <hr class="social-separator" />
      <div class="social-link">
        <img src="/static/link2.png" alt="GitHub" class="social-icon" />
        <a href="https://github.com/yourprofile" target="_blank">GitHub</a>
      </div>
      <hr class="social-separator" />
      <div class="social-link">
        <img src="/static/youp.png" alt="YouTube" class="social-icon" />
        <a href="https://youtube.com/yourchannel" target="_blank">YouTube</a>
      </div>
    </div>
      <div class="side-menu-footer">
        © 2025 ChainShots v1.0
      </div>
    </div>


  </div>

<script>
let currentCategory = 'daily-news';

async function loadNews(category = 'daily-news') {
  currentCategory = category;
  const container = document.getElementById('news-container');
  container.innerHTML = '';

  // Always fetch fresh data from server
  const res = await fetch(`/news?category=${category}`);
  let articles = await res.json();

  // Remove previously swiped articles
  const removed = JSON.parse(sessionStorage.getItem(`removed-${category}`)) || [];
  articles = articles.filter(article => !removed.includes(article.link));

  // Cache filtered articles
  sessionStorage.setItem(`news-${category}`, JSON.stringify(articles));

  renderArticles(articles);
}

function renderArticles(articles) {
  const container = document.getElementById('news-container');
  container.innerHTML = '';

  if (!articles.length) {
    container.innerHTML = '<div style="color:#ccc;padding:1rem;">No more news in this category.</div>';
    return;
  }

  articles.forEach(article => {
    const card = document.createElement('div');
    card.className = 'card';
    card.innerHTML = `
      <img src="${article.image_url || 'https://via.placeholder.com/400x200'}" alt="News Image" />
      <div class="card-content">
        <div class="title">${article.title}</div>
        <div class="summary">${article.summary}</div>
        <div class="read-more">
          <a href="${article.link}" target="_blank">Read more</a>
        </div>
      </div>
    `;
    container.appendChild(card);
  });

  initSwipe();
}

function initSwipe() {
  const cards = document.querySelectorAll('.card');
  let topCard = cards[cards.length - 1];
  if (!topCard) return;

  topCard.addEventListener('mousedown', startDrag);
  topCard.addEventListener('touchstart', startDrag);

  let isDragging = false;
  let startX, currentX;

function startDrag(e) {
  isDragging = true;
  currentX = undefined;
  startX = e.type === 'mousedown' ? e.clientX : e.touches[0].clientX;
  topCard.classList.add('swiping'); // ✅ Add glow effect
  document.addEventListener('mousemove', onDrag);
  document.addEventListener('mouseup', endDrag);
  document.addEventListener('touchmove', onDrag);
  document.addEventListener('touchend', endDrag);
}

  function onDrag(e) {
    if (!isDragging) return;
    currentX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;
    const deltaX = currentX - startX;
    topCard.style.transform = `translateX(${deltaX}px) rotate(${deltaX / 10}deg)`;
  }

  function endDrag() {
    isDragging = false;
    topCard.classList.remove('swiping'); // ✅ Remove glow effect on drag end
    //const deltaX = currentX - startX;
    //const threshold = 150;
    const threshold = window.innerWidth < 480 ? 60 : 100;
    const deltaX = currentX !== undefined ? currentX - startX : 0;

    if (Math.abs(deltaX) > threshold) {
      topCard.style.transition = 'transform 0.4s ease, opacity 0.4s ease';
      topCard.style.transform = `translateX(${deltaX > 0 ? 1000 : -1000}px) rotate(${deltaX > 0 ? 20 : -20}deg)`;
      topCard.style.opacity = '0';

    setTimeout(() => {
      const link = topCard.querySelector('.read-more a').href;
      topCard.remove();

      // ✅ Track removed articles
      const removedKey = `removed-${currentCategory}`;
      let removed = JSON.parse(sessionStorage.getItem(removedKey)) || [];
      removed.push(link);
      sessionStorage.setItem(removedKey, JSON.stringify(removed));

      // ✅ Update cached list
      const cached = JSON.parse(sessionStorage.getItem(`news-${currentCategory}`)) || [];
      const updated = cached.filter(article => article.link !== link);
      sessionStorage.setItem(`news-${currentCategory}`, JSON.stringify(updated));

      const newCards = document.querySelectorAll('.card');
      topCard = newCards[newCards.length - 1];

      if (topCard) {
        // ✅ Reattach swipe handlers immediately
        requestAnimationFrame(() => {
          topCard.addEventListener('mousedown', startDrag);
          topCard.addEventListener('touchstart', startDrag);
        });
      } else {
        // 🔁 Auto-loop logic
        setTimeout(() => {
          sessionStorage.removeItem(`removed-${currentCategory}`);
          loadNews(currentCategory);
        }, 300);
      }
    }, 400);
    } else {
      // It's just a tap — reset transform
      topCard.style.transition = 'transform 0.3s ease';
      topCard.style.transform = 'translateX(0px) rotate(0deg)';
    }

    document.removeEventListener('mousemove', onDrag);
    document.removeEventListener('mouseup', endDrag);
    document.removeEventListener('touchmove', onDrag);
    document.removeEventListener('touchend', endDrag);
  }
}

// Category Switching
document.querySelectorAll('.category-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    const selectedCategory = btn.getAttribute('data-category');
    loadNews(selectedCategory);
  });
});

// Clear session cache if page is reloaded
const navType = performance.getEntriesByType("navigation")[0]?.type || performance.navigation.type;
if (navType === "reload") {
  Object.keys(sessionStorage)
    .filter(key => key.startsWith('news-') || key.startsWith('removed-'))
    .forEach(key => sessionStorage.removeItem(key));
}

// Initial Load
loadNews();

//side Menu
const hamburger = document.querySelector('.hamburger-menu');
const sideMenu = document.getElementById('sideMenu');

hamburger.addEventListener('click', () => {
  sideMenu.classList.toggle('open');
});

document.addEventListener('click', (e) => {
  if (!sideMenu.contains(e.target) && !hamburger.contains(e.target)) {
    sideMenu.classList.remove('open');
  }
});

</script>

</body>
</html>     

