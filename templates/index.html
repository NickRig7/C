<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Swipe News Cards</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&display=swap" rel="stylesheet">

  <!-- Manifest and theme color -->
  <link rel="manifest" href="/static/manifest.json" />
  <meta name="theme-color" content="#00bcd4" />

  <!-- iOS PWA support (optional but good) -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <link rel="apple-touch-icon" href="/static/icons/cso.jpg" />

  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: #121212;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      overflow: hidden;
    }

    .main-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
    }

    .info-box {
      display: none;
      width: 370px;
      background-image: url('/static/xyz.png');
      background-size: cover;
      background-repeat: no-repeat;
      background-position: center;
      background-color: rgba(0, 0, 0, 0.5);
      background-blend-mode: darken;
      color: #ffffff;
      padding: 0.6rem 1rem 0.4rem;
      border-radius: 20px 20px 0 0;
      text-align: center;
      z-index: 3;
      position: relative;
      margin-bottom: -20px;
      overflow: hidden;
      box-shadow: 0 0 20px rgba(175, 189, 189, 0.2);
    }

    .info-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      width: 100%;
      position: relative;
    }

    .info-title {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      font-family: 'Montserrat', sans-serif;
      font-weight: 700;
      font-size: 1.2rem;
      line-height: 40px;
      letter-spacing: 1px;
      color: #d6c5c5;
    }

    .info-logo-inline {
      height: 52px;
      width: auto;
    }

    .category-scroll {
      display: flex;
      overflow-x: auto;
      padding: 0.5rem 0.5rem;
      gap: 0.5rem;
      max-width: 400px;
      margin: 0 auto 0;
      scrollbar-width: none;
      -ms-overflow-style: none;
      border-radius: 20px;
    }

    .category-scroll::-webkit-scrollbar {
      display: none;
    }

    .category-btn {
      flex: 0 0 auto;
      background-color: #1e1e1e;
      border: none;
      padding: 0.4rem 0.8rem;
      color: #ffffff;
      border-radius: 20px;
      font-size: 0.85rem;
      cursor: pointer;
      transition: background 0.3s, box-shadow 0.3s;
      box-shadow: 0 0 12px rgba(175, 189, 189, 0.1);
    }

    .category-btn:hover {
      background-color: #171616;
      box-shadow: 0 0 15px rgba(250, 251, 251, 0.371);
    }

    .category-btn.active {
      background-color: #00bcd4;
      color: #121212;
      font-weight: bold;
      box-shadow: 0 0 20px rgba(0, 255, 255, 0.4);
    }

    .card-stack {
      display: none;
      position: relative;
      width: 400px;
      height: 550px;
      z-index: 1;
      box-shadow: 0 0 50px rgba(175, 189, 189, 0.2);
      transition: box-shadow 0.4s ease;
      border-radius: 20px;
    }

    .card {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #1e1e1e;
      border-radius: 20px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      cursor: grab;
      transition: transform 0.3s ease, opacity 0.3s ease, box-shadow 0.3s ease;
    }

    .card:hover {
      box-shadow: 0 0 20px 4px rgba(0, 255, 255, 0.6), 0 0 30px 10px rgba(0, 255, 255, 0.2);
      transform: scale(1.006);
    }

    .card img {
      width: 100%;
      height: 220px;
      object-fit: cover;
    }

    .card-content {
      padding: 1.5rem;
      display: flex;
      flex-direction: column;
      flex-grow: 1;
    }

    .title {
      font-size: 1.2rem;
      font-weight: bold;
      margin-bottom: 0.8rem;
      color: #ffffff;
    }

    .summary {
      font-size: 1.05rem;
      color: #cccccc;
      line-height: 1.4;
      flex-grow: 1;
    }

    .read-more {
      margin-top: 1rem;
      text-align: right;
    }

    .read-more a {
      text-decoration: none;
      color: #00bcd4;
      font-weight: bold;
      font-size: 0.9rem;
      transition: color 0.3s ease;
    }

    .read-more a:hover {
      color: #1de9b6;
      text-decoration: underline;
    }

    .hamburger-menu {
      margin-left: auto;
      margin-right: 4px;
      font-size: 14px;
      cursor: pointer;
      color: #000;
      padding: 4px 10px;
      background-color: #a38b6c;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(255, 255, 255, 0.1);
      transition: background 0.3s;
    }

    .hamburger-menu:hover {
      background-color: #e0e0e0;
    }

    /* SIDE MENU */
  .side-menu {
    display: none;
    position: absolute;
    top: 0;
    right: -78%;
    width: 70%;
    height: 611.2px;
    background-color: rgba(30, 30, 30, 0.7); /* Transparent background */
    backdrop-filter: blur(8px); /* Optional glassmorphism effect */
    z-index: 5;
    box-shadow: -4px 0 20px rgba(0, 0, 0, 0.5);
    transition: right 0.3s ease, opacity 0.3s ease;
    border-radius: 20px 20px 20px 20px;
    padding: 1rem;
    overflow-y: auto;
    color: #fff;
    opacity: 0;
    pointer-events: none;
    display: flex;
  flex-direction: column;
  }

.side-menu.open {
  right: 0;
  opacity: 1;
  pointer-events: auto;
}

.side-menu-img {
  width: 100%;
  height: 30%;
  object-fit: cover;
  border-radius: 20px 20px 0 0;
  filter: brightness(0.6) saturate(2); /* Darkens the image */
  /*filter: brightness(0.7) sepia(10) hue-rotate(180deg) /*saturate(2);*/
}

  /*socials*/

.social-links {
  margin-top: 2rem;
  display: flex;
  flex-direction: column;
  gap: 0.6rem; /* reduced from 1.5rem */
  left: 20%;
}


.social-link {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  font-size: 1rem;
  color: #ffffff;
  padding-left: 2rem; /* ⬅️ Add this line */
}

.social-link a {
  color: #ffffff;
  text-decoration: none;
  font-weight: 500;
  transition: color 0.3s ease;
}

.social-link a:hover {
  color: #00bcd4;
  /*text-decoration: underline; */
}

.social-icon {
  width: 30px;
  height: 30px;
  object-fit: contain;
}

.social-separator {
  border: none;
  height: 1px;
  background-color: rgba(150, 150, 150, 0.25); /* subtle darker line */
  margin: 0.1rem 0; /* very tight spacing */
  width: 55%;
  align-self: center;
}

.side-menu-footer {
  margin-top: 168px; /* Push to bottom auto*/
  padding-top: 1rem;
  font-size: 0.75rem;
  color: rgba(255, 255, 255, 0.4); /* Subtle light gray */
  text-align: center;
}

  </style>
</head>

<body>
  <div class="main-container">
    <div class="info-box">
      <div class="info-header">
        <img src="/static/logo.png" alt="Logo" class="info-logo-inline" />
        <span class="info-title">ChainShots</span>
        <div class="hamburger-menu">&#9776;</div>
      </div>
      <div class="category-scroll">
        <button class="category-btn active" data-category="daily-news">Daily News</button>
        <button class="category-btn" data-category="edu">Edu Bites</button>
        <button class="category-btn" data-category="btca">BTC Action</button>
        <!--<button class="category-btn" data-category="crypto">Crypto</button>
        <button class="category-btn" data-category="blockchain">Blockchain</button>-->
        <button class="category-btn" data-category="for-you">For You</button>
      </div>
    </div>

    <div class="card-stack" id="news-container"></div>

  <!-- Developer Signature (temporary) -->
  <div id="dev-signature" style="
    margin-top: 12px;
    font-size: 0.75rem;
    color: rgba(33, 33, 33, 0.2);
    font-family: 'Segoe UI', sans-serif;
    text-align: center;
    user-select: none;
    transition: opacity 0.5s ease;
    position: fixed;
  ">
    Developed by Bikash
  </div>

    <div class="side-menu" id="sideMenu">
      <img src="/static/abc.png" alt="Side Menu Banner" class="side-menu-img" />
      <div class="social-links">
        <div class="social-link">
          <img src="/static/twwit.png" alt="Twitter" class="social-icon" />
          <a href="https://twitter.com/yourhandle" target="_blank">Twitter</a>
        </div>
        <hr class="social-separator" />
        <div class="social-link">
          <img src="/static/web.png" alt="Telegram" class="social-icon" />
          <a href="https://t.me/yourhandle" target="_blank">Website</a>
        </div>
        <hr class="social-separator" />
        <div class="social-link">
          <img src="/static/link2.png" alt="LinkedIn" class="social-icon" />
          <a href="https://github.com/yourprofile" target="_blank">LinkedIn</a>
        </div>
        <hr class="social-separator" />
        <div class="social-link">
          <img src="/static/youp.png" alt="GitHub" class="social-icon" />
          <a href="https://github.com/yourprofile" target="_blank">YouTube</a>
        </div>
      </div>
      <div class="side-menu-footer">
        © 2025 ChainShots v1.0
      </div>
    </div>

    

  </div>

<script>
let currentCategory = 'daily-news';

async function loadNews(category = 'daily-news') {
  currentCategory = category;
  const container = document.getElementById('news-container');
  container.innerHTML = '';

  // Always fetch fresh data from server
  const res = await fetch(`/news?category=${category}`);
  let articles = await res.json();

  // Remove previously swiped articles
  const removed = JSON.parse(sessionStorage.getItem(`removed-${category}`)) || [];
  articles = articles.filter(article => !removed.includes(article.link));

  // Cache filtered articles
  sessionStorage.setItem(`news-${category}`, JSON.stringify(articles));
  renderArticles(articles);

  document.querySelector('.info-box').style.display = 'block';
  document.querySelector('.card-stack').style.display = 'block';
  document.getElementById('sideMenu').style.display = 'block';
}

function renderArticles(articles) {
  const container = document.getElementById('news-container');
  container.innerHTML = '';

  if (!articles.length) {
    container.innerHTML = '<div class="title" style="padding: 1rem; color: #ccc;">No more news in this category.</div>';
    return;
  }

  articles.forEach(article => { 
    const card = document.createElement('div'); 
    card.className = 'card';
    card.innerHTML = `
      <img src="${article.image_url || 'https://via.placeholder.com/400x180'}" alt="" />
      <div class="card-content">
        <div class="title">${article.title}</div>
        <div class="summary">${article.summary}</div>
        <div class="read-more">
          <a href="${article.link}" target="_blank">Read more</a>
        </div>
      </div>
    `;
    container.appendChild(card);
  });

    // Hide the signature once articles are rendered
  const sig = document.getElementById('dev-signature');
  if (sig) {
    sig.style.opacity = '0';
    setTimeout(() => sig.remove(), 600);
  }


  initSwipe();
}

function initSwipe() {
  const cards = document.querySelectorAll('.card');
  let topCard = cards[cards.length - 1];
  if (!topCard) return;

  topCard.addEventListener('mousedown', startDrag);
  topCard.addEventListener('touchstart', startDrag);

  let isDragging = false;
  let startX, currentX;

  function startDrag(e) {
    isDragging = true;
    startX = e.type === 'mousedown' ? e.clientX : e.touches[0].clientX;
    document.addEventListener('mousemove', onDrag);
    document.addEventListener('mouseup', endDrag);
    document.addEventListener('touchmove', onDrag);
    document.addEventListener('touchend', endDrag);
  }

  function onDrag(e) {
    if (!isDragging) return;
    currentX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;
    const deltaX = currentX - startX;
    topCard.style.transform = `translateX(${deltaX}px) rotate(${deltaX / 10}deg)`;
  }

  function endDrag() {
    isDragging = false;
    const deltaX = currentX - startX;
    const threshold = 150;

    if (Math.abs(deltaX) > threshold) {
      topCard.style.transition = 'transform 0.4s ease, opacity 0.4s ease';
      topCard.style.transform = `translateX(${deltaX > 0 ? 1000 : -1000}px) rotate(${deltaX > 0 ? 20 : -20}deg)`;
      topCard.style.opacity = '0';

      setTimeout(() => {
        const link = topCard.querySelector('.read-more a').href;
        topCard.remove();

        // ✅ Track removed articles
        const removedKey = `removed-${currentCategory}`;
        let removed = JSON.parse(sessionStorage.getItem(removedKey)) || [];
        removed.push(link);
        sessionStorage.setItem(removedKey, JSON.stringify(removed));

        // ✅ Update cached list
        const cached = JSON.parse(sessionStorage.getItem(`news-${currentCategory}`)) || [];
        const updated = cached.filter(article => article.link !== link);
        sessionStorage.setItem(`news-${currentCategory}`, JSON.stringify(updated));

        const newCards = document.querySelectorAll('.card');
        topCard = newCards[newCards.length - 1];

        if (topCard) {
          topCard.addEventListener('mousedown', startDrag);
          topCard.addEventListener('touchstart', startDrag);
        } else {
          // 🔁 Auto-loop logic
          setTimeout(() => {
            sessionStorage.removeItem(`removed-${currentCategory}`);
            loadNews(currentCategory);
          }, 300);
        }
      }, 400);
    } else {
      topCard.style.transition = 'transform 0.3s ease';
      topCard.style.transform = 'translateX(0px) rotate(0deg)';
    }

    document.removeEventListener('mousemove', onDrag);
    document.removeEventListener('mouseup', endDrag);
    document.removeEventListener('touchmove', onDrag);
    document.removeEventListener('touchend', endDrag);
  }
}


document.querySelectorAll('.category-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    const selectedCategory = btn.getAttribute('data-category');
    loadNews(selectedCategory);
  });
});

const hamburger = document.querySelector('.hamburger-menu');
const sideMenu = document.getElementById('sideMenu');

hamburger.addEventListener('click', () => {
  sideMenu.classList.toggle('open');
});

document.addEventListener('click', (e) => {
  const isClickInsideMenu = sideMenu.contains(e.target);
  const isClickOnHamburger = hamburger.contains(e.target);
  if (!isClickInsideMenu && !isClickOnHamburger && sideMenu.classList.contains('open')) {
    sideMenu.classList.remove('open');
  }
});

// Clear session cache if page is reloaded
const navType = performance.getEntriesByType("navigation")[0]?.type || performance.navigation.type;
if (navType === "reload") {
  Object.keys(sessionStorage)
    .filter(key => key.startsWith('news-'))
    .forEach(key => sessionStorage.removeItem(key));
}

loadNews();
</script>
<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('/static/service-worker.js')
        .then(reg => console.log('Service Worker registered:', reg.scope))
        .catch(err => console.error('Service Worker registration failed:', err));
    });
  }
</script>

</body>
</html>
